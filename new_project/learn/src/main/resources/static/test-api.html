<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ™ºæ…§æ•™å­¦å¹³å° API æµ‹è¯•</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background-color: #f5f5f5;
            color: #333;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            border-radius: 10px;
            margin-bottom: 30px;
            text-align: center;
        }
        
        .api-section {
            background: white;
            border-radius: 10px;
            padding: 25px;
            margin-bottom: 25px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }
        
        .api-section h2 {
            color: #4a5568;
            margin-bottom: 20px;
            font-size: 1.5em;
            border-bottom: 2px solid #e2e8f0;
            padding-bottom: 10px;
        }
        
        .btn {
            background: #4299e1;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            cursor: pointer;
            margin: 5px;
            font-size: 14px;
            transition: all 0.3s ease;
        }
        
        .btn:hover {
            background: #3182ce;
            transform: translateY(-1px);
        }
        
        .btn.success {
            background: #48bb78;
        }
        
        .btn.warning {
            background: #ed8936;
        }
        
        .btn.danger {
            background: #f56565;
        }
        
        .result {
            background: #f7fafc;
            border: 1px solid #e2e8f0;
            border-radius: 6px;
            padding: 15px;
            margin-top: 15px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            max-height: 400px;
            overflow-y: auto;
        }
        
        .schedule-card {
            background: #fff;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            padding: 15px;
            margin: 10px 0;
            transition: all 0.3s ease;
        }
        
        .schedule-card:hover {
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }
        
        .schedule-card.upcoming {
            border-left: 4px solid #f6ad55;
            background: #fffaf0;
        }
        
        .schedule-card.ongoing {
            border-left: 4px solid #48bb78;
            background: #f0fff4;
        }
        
        .schedule-time {
            font-weight: bold;
            color: #4a5568;
            font-size: 1.1em;
        }
        
        .schedule-info h3 {
            color: #2d3748;
            margin: 8px 0;
        }
        
        .schedule-meta {
            color: #718096;
            font-size: 0.9em;
        }
        
        .schedule-meta span {
            margin-right: 15px;
        }
        
        .metric-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .metric-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
        }
        
        .metric-value {
            font-size: 2.5em;
            font-weight: bold;
            margin: 10px 0;
        }
        
        .todo-item {
            background: white;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            padding: 15px;
            margin: 10px 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .todo-item.priority-urgent {
            border-left: 4px solid #f56565;
            background: #fed7d7;
        }
        
        .todo-item.priority-important {
            border-left: 4px solid #ed8936;
            background: #feebc8;
        }
        
        .login-form {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            max-width: 400px;
            margin: 0 auto;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
        }
        
        .form-group input {
            width: 100%;
            padding: 12px;
            border: 1px solid #e2e8f0;
            border-radius: 6px;
            font-size: 14px;
        }
        
        .auth-status {
            padding: 15px;
            border-radius: 6px;
            margin-bottom: 20px;
            text-align: center;
        }
        
        .auth-status.logged-in {
            background: #c6f6d5;
            color: #276749;
        }
        
        .auth-status.logged-out {
            background: #fed7d7;
            color: #c53030;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>æ™ºæ…§æ•™å­¦å¹³å° API æµ‹è¯•</h1>
            <p>æµ‹è¯•æ‰€æœ‰æ ¸å¿ƒåŠŸèƒ½æ¥å£</p>
        </div>
        
        <!-- è®¤è¯çŠ¶æ€ -->
        <div class="api-section">
            <h2>ğŸ” ç”¨æˆ·è®¤è¯</h2>
            <div id="authStatus" class="auth-status logged-out">
                æœªç™»å½• - è¯·å…ˆç™»å½•ä»¥æµ‹è¯•å…¶ä»–æ¥å£
            </div>
            
            <div class="login-form">
                <div class="form-group">
                    <label>ç”¨æˆ·å:</label>
                    <input type="text" id="username" placeholder="è¾“å…¥ç”¨æˆ·å" value="teacher1">
                </div>
                <div class="form-group">
                    <label>å¯†ç :</label>
                    <input type="password" id="password" placeholder="è¾“å…¥å¯†ç " value="123456">
                </div>
                <button class="btn" onclick="login()">ç™»å½•</button>
                <button class="btn warning" onclick="logout()">é€€å‡ºç™»å½•</button>
                <button class="btn success" onclick="getCurrentUser()">è·å–å½“å‰ç”¨æˆ·</button>
            </div>
            
            <div id="authResult" class="result" style="display: none;"></div>
        </div>
        
        <!-- ä»Šæ—¥æ•™å­¦æ—¥ç¨‹ -->
        <div class="api-section">
            <h2>ğŸ“… ä»Šæ—¥æ•™å­¦æ—¥ç¨‹</h2>
            <button class="btn" onclick="getTodaySchedules()">è·å–ä»Šæ—¥è¯¾ç¨‹å®‰æ’</button>
            <button class="btn" onclick="getWeekSchedules()">è·å–æœ¬å‘¨è¯¾ç¨‹å®‰æ’</button>
            <button class="btn" onclick="getOngoingSchedules()">è·å–æ­£åœ¨è¿›è¡Œçš„è¯¾ç¨‹</button>
            <button class="btn" onclick="getUpcomingSchedules()">è·å–å³å°†å¼€å§‹çš„è¯¾ç¨‹</button>
            <button class="btn warning" onclick="getSchedulesByDate()">è·å–æŒ‡å®šæ—¥æœŸè¯¾ç¨‹</button>
            
            <div id="scheduleResult" class="result" style="display: none;"></div>
            <div id="scheduleDisplay"></div>
        </div>
        
        <!-- å­¦æƒ…åˆ†æ -->
        <div class="api-section">
            <h2>ğŸ“Š å­¦æƒ…åˆ†æ</h2>
            <button class="btn success" onclick="getAnalyticsOverview()">è·å–å­¦æƒ…åˆ†ææ¦‚è§ˆ</button>
            
            <div id="analyticsResult" class="result" style="display: none;"></div>
            <div id="analyticsDisplay"></div>
        </div>
        
        <!-- å¾…åŠäº‹é¡¹ -->
        <div class="api-section">
            <h2>âœ… å¾…åŠäº‹é¡¹</h2>
            <button class="btn" onclick="getTodos()">è·å–å¾…åŠåˆ—è¡¨</button>
            <button class="btn success" onclick="createTestTodo()">åˆ›å»ºæµ‹è¯•å¾…åŠ</button>
            
            <div id="todoResult" class="result" style="display: none;"></div>
            <div id="todoDisplay"></div>
        </div>
        
        <!-- AIæ¨è -->
        <div class="api-section">
            <h2>ğŸ¤– AIæ¨è</h2>
            <button class="btn" onclick="getRecommendations()">è·å–ä¸ªæ€§åŒ–æ¨è</button>
            
            <div id="recommendationResult" class="result" style="display: none;"></div>
        </div>
    </div>

    <script>
        // APIåŸºç¡€é…ç½®
        const API_BASE = 'http://localhost:8080';
        let authToken = localStorage.getItem('authToken');
        
        // æ›´æ–°è®¤è¯çŠ¶æ€æ˜¾ç¤º
        function updateAuthStatus() {
            const authStatus = document.getElementById('authStatus');
            if (authToken) {
                authStatus.className = 'auth-status logged-in';
                authStatus.textContent = 'å·²ç™»å½• - å¯ä»¥æµ‹è¯•æ‰€æœ‰æ¥å£';
            } else {
                authStatus.className = 'auth-status logged-out';
                authStatus.textContent = 'æœªç™»å½• - è¯·å…ˆç™»å½•ä»¥æµ‹è¯•å…¶ä»–æ¥å£';
            }
        }
        
        // åˆå§‹åŒ–é¡µé¢
        updateAuthStatus();
        
        // é€šç”¨APIè¯·æ±‚å‡½æ•°
        async function apiRequest(endpoint, method = 'GET', data = null) {
            const options = {
                method,
                headers: {
                    'Content-Type': 'application/json',
                }
            };
            
            if (authToken) {
                options.headers['Authorization'] = 'Bearer ' + authToken;
            }
            
            if (data) {
                options.body = JSON.stringify(data);
            }
            
            try {
                const response = await fetch(API_BASE + endpoint, options);
                const result = await response.json();
                return result;
            } catch (error) {
                console.error('APIè¯·æ±‚å¤±è´¥:', error);
                return { code: 500, message: 'ç½‘ç»œè¯·æ±‚å¤±è´¥: ' + error.message };
            }
        }
        
        // æ˜¾ç¤ºç»“æœ
        function showResult(elementId, data) {
            const element = document.getElementById(elementId);
            element.style.display = 'block';
            element.textContent = JSON.stringify(data, null, 2);
        }
        
        // === è®¤è¯ç›¸å…³ ===
        async function login() {
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            
            if (!username || !password) {
                alert('è¯·è¾“å…¥ç”¨æˆ·åå’Œå¯†ç ');
                return;
            }
            
            const result = await apiRequest('/api/auth/login', 'POST', { username, password });
            showResult('authResult', result);
            
            if (result.code === 200) {
                authToken = result.data.token;
                localStorage.setItem('authToken', authToken);
                localStorage.setItem('user', JSON.stringify(result.data.user));
                updateAuthStatus();
                alert('ç™»å½•æˆåŠŸï¼');
            } else {
                alert('ç™»å½•å¤±è´¥: ' + result.message);
            }
        }
        
        function logout() {
            authToken = null;
            localStorage.removeItem('authToken');
            localStorage.removeItem('user');
            updateAuthStatus();
            document.getElementById('authResult').style.display = 'none';
            alert('å·²é€€å‡ºç™»å½•');
        }
        
        async function getCurrentUser() {
            if (!authToken) {
                alert('è¯·å…ˆç™»å½•');
                return;
            }
            
            const result = await apiRequest('/api/auth/me');
            showResult('authResult', result);
        }
        
        // === è¯¾ç¨‹å®‰æ’ç›¸å…³ ===
        async function getTodaySchedules() {
            if (!authToken) {
                alert('è¯·å…ˆç™»å½•');
                return;
            }
            
            const result = await apiRequest('/api/schedules/today');
            showResult('scheduleResult', result);
            
            if (result.code === 200) {
                displaySchedules(result.data);
            }
        }
        
        async function getWeekSchedules() {
            if (!authToken) {
                alert('è¯·å…ˆç™»å½•');
                return;
            }
            
            const result = await apiRequest('/api/schedules/week');
            showResult('scheduleResult', result);
            
            if (result.code === 200) {
                displaySchedules(result.data);
            }
        }
        
        async function getOngoingSchedules() {
            if (!authToken) {
                alert('è¯·å…ˆç™»å½•');
                return;
            }
            
            const result = await apiRequest('/api/schedules/ongoing');
            showResult('scheduleResult', result);
            
            if (result.code === 200) {
                displaySchedules(result.data);
            }
        }
        
        async function getUpcomingSchedules() {
            if (!authToken) {
                alert('è¯·å…ˆç™»å½•');
                return;
            }
            
            const result = await apiRequest('/api/schedules/upcoming');
            showResult('scheduleResult', result);
            
            if (result.code === 200) {
                displaySchedules(result.data);
            }
        }
        
        async function getSchedulesByDate() {
            if (!authToken) {
                alert('è¯·å…ˆç™»å½•');
                return;
            }
            
            const date = prompt('è¯·è¾“å…¥æ—¥æœŸ (æ ¼å¼: yyyy-MM-dd)', '2024-01-15');
            if (!date) return;
            
            const result = await apiRequest(`/api/schedules/date/${date}`);
            showResult('scheduleResult', result);
            
            if (result.code === 200) {
                displaySchedules(result.data);
            }
        }
        
        function displaySchedules(schedules) {
            const display = document.getElementById('scheduleDisplay');
            
            if (!schedules || schedules.length === 0) {
                display.innerHTML = '<p>æš‚æ— è¯¾ç¨‹å®‰æ’</p>';
                return;
            }
            
            let html = '<h3>è¯¾ç¨‹å®‰æ’åˆ—è¡¨:</h3>';
            schedules.forEach(schedule => {
                const cardClass = schedule.isOngoing ? 'ongoing' : (schedule.isUpcoming ? 'upcoming' : '');
                html += `
                    <div class="schedule-card ${cardClass}">
                        <div class="schedule-time">${schedule.timeRange}</div>
                        <div class="schedule-info">
                            <h3>${schedule.courseName} (${schedule.courseCode})</h3>
                            <p>${schedule.lessonTopic}</p>
                            <div class="schedule-meta">
                                <span>ç­çº§: ${schedule.className}</span>
                                <span>æ•™å®¤: ${schedule.classroom}</span>
                                <span>çŠ¶æ€: ${schedule.statusText}</span>
                                <span>æ•™å¸ˆ: ${schedule.teacherName}</span>
                            </div>
                        </div>
                        <button class="btn" onclick="updateScheduleStatus(${schedule.id}, 'ONGOING')">å¼€å§‹ä¸Šè¯¾</button>
                        <button class="btn success" onclick="updateScheduleStatus(${schedule.id}, 'COMPLETED')">ç»“æŸè¯¾ç¨‹</button>
                    </div>
                `;
            });
            display.innerHTML = html;
        }
        
        async function updateScheduleStatus(scheduleId, status) {
            if (!authToken) {
                alert('è¯·å…ˆç™»å½•');
                return;
            }
            
            const result = await apiRequest(`/api/schedules/${scheduleId}/status?status=${status}`, 'PUT');
            
            if (result.code === 200) {
                alert('çŠ¶æ€æ›´æ–°æˆåŠŸï¼');
                getTodaySchedules(); // åˆ·æ–°åˆ—è¡¨
            } else {
                alert('çŠ¶æ€æ›´æ–°å¤±è´¥: ' + result.message);
            }
        }
        
        // === å­¦æƒ…åˆ†æç›¸å…³ ===
        async function getAnalyticsOverview() {
            if (!authToken) {
                alert('è¯·å…ˆç™»å½•');
                return;
            }
            
            const result = await apiRequest('/api/analytics/overview');
            showResult('analyticsResult', result);
            
            if (result.code === 200) {
                displayAnalytics(result.data);
            }
        }
        
        function displayAnalytics(analytics) {
            const display = document.getElementById('analyticsDisplay');
            
            let html = `
                <h3>å­¦æƒ…åˆ†ææ¦‚è§ˆ:</h3>
                <div class="metric-grid">
                    <div class="metric-card">
                        <h4>çŸ¥è¯†æŒæ¡ç‡</h4>
                        <div class="metric-value">${analytics.knowledgeMasteryRate || 0}%</div>
                    </div>
                    <div class="metric-card">
                        <h4>ä½œä¸šå®Œæˆç‡</h4>
                        <div class="metric-value">${analytics.assignmentCompletionRate || 0}%</div>
                    </div>
                    <div class="metric-card">
                        <h4>è¯¾å ‚å‚ä¸åº¦</h4>
                        <div class="metric-value">${analytics.classParticipationRate || 0}%</div>
                    </div>
                    <div class="metric-card">
                        <h4>å¹³å‡æˆç»©</h4>
                        <div class="metric-value">${analytics.averageScore || 0}</div>
                    </div>
                </div>
            `;
            
            if (analytics.todayData) {
                html += `
                    <h4>ä»Šæ—¥æ•°æ®:</h4>
                    <p>å‡ºå‹¤äººæ•°: ${analytics.todayData.todayAttendance || 0}</p>
                    <p>ä½œä¸šæäº¤: ${analytics.todayData.todayAssignmentSubmissions || 0}</p>
                    <p>æ´»è·ƒå­¦ä¹ è€…: ${analytics.todayData.activeLearners || 0}</p>
                `;
            }
            
            display.innerHTML = html;
        }
        
        // === å¾…åŠäº‹é¡¹ç›¸å…³ ===
        async function getTodos() {
            if (!authToken) {
                alert('è¯·å…ˆç™»å½•');
                return;
            }
            
            const result = await apiRequest('/api/todos');
            showResult('todoResult', result);
            
            if (result.code === 200) {
                displayTodos(result.data);
            }
        }
        
        async function createTestTodo() {
            if (!authToken) {
                alert('è¯·å…ˆç™»å½•');
                return;
            }
            
            const todoData = {
                title: 'æµ‹è¯•å¾…åŠäº‹é¡¹ - ' + new Date().toLocaleString(),
                description: 'è¿™æ˜¯ä¸€ä¸ªé€šè¿‡APIæµ‹è¯•é¡µé¢åˆ›å»ºçš„å¾…åŠäº‹é¡¹',
                priority: 'NORMAL',
                category: 'æµ‹è¯•',
                dueDate: new Date(Date.now() + 24 * 60 * 60 * 1000).toISOString().slice(0, 19).replace('T', ' ')
            };
            
            const result = await apiRequest('/api/todos', 'POST', todoData);
            showResult('todoResult', result);
            
            if (result.code === 200) {
                alert('æµ‹è¯•å¾…åŠäº‹é¡¹åˆ›å»ºæˆåŠŸï¼');
                getTodos(); // åˆ·æ–°åˆ—è¡¨
            } else {
                alert('åˆ›å»ºå¤±è´¥: ' + result.message);
            }
        }
        
        function displayTodos(todos) {
            const display = document.getElementById('todoDisplay');
            
            if (!todos || todos.length === 0) {
                display.innerHTML = '<p>æš‚æ— å¾…åŠäº‹é¡¹</p>';
                return;
            }
            
            let html = '<h3>å¾…åŠäº‹é¡¹åˆ—è¡¨:</h3>';
            todos.forEach(todo => {
                html += `
                    <div class="todo-item priority-${todo.priority.toLowerCase()}">
                        <div>
                            <h4>${todo.title}</h4>
                            <p>${todo.description}</p>
                            <small>åˆ†ç±»: ${todo.category} | ä¼˜å…ˆçº§: ${todo.priority} | çŠ¶æ€: ${todo.status}</small>
                        </div>
                        <button class="btn success" onclick="completeTodo(${todo.id})">å®Œæˆ</button>
                    </div>
                `;
            });
            display.innerHTML = html;
        }
        
        async function completeTodo(todoId) {
            if (!authToken) {
                alert('è¯·å…ˆç™»å½•');
                return;
            }
            
            const result = await apiRequest(`/api/todos/${todoId}`, 'PUT', { status: 'COMPLETED' });
            
            if (result.code === 200) {
                alert('å¾…åŠäº‹é¡¹å·²å®Œæˆï¼');
                getTodos(); // åˆ·æ–°åˆ—è¡¨
            } else {
                alert('æ“ä½œå¤±è´¥: ' + result.message);
            }
        }
        
        // === AIæ¨èç›¸å…³ ===
        async function getRecommendations() {
            if (!authToken) {
                alert('è¯·å…ˆç™»å½•');
                return;
            }
            
            const result = await apiRequest('/api/recommendations');
            showResult('recommendationResult', result);
        }
    </script>
</body>
</html> 